<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shichuan.zhiyuan.mappers.VideoInfoMappers">
	<!--实体映射-->
	<resultMap id="base_result_map" type="shichuan.zhiyuan.entity.po.VideoInfo">
		<!-- ID -->
		<id column="id" property="id"/>
		<!--  -->
		<result column="title" property="title"/>
		<!--  -->
		<result column="description" property="description"/>
		<!--  -->
		<result column="category" property="category"/>
		<!-- URL -->
		<result column="video_url" property="videoUrl"/>
		<!--  -->
		<result column="duration" property="duration"/>
		<!--  -->
		<result column="publish_time" property="publishTime"/>

	</resultMap>

	<!--通用查询列-->
	<sql id="base_column_list">
		id,title,description,category,video_url,duration,publish_time
	</sql>

	<!--基础查询条件-->
	<sql id="base_query_condition">

		<if test="query.id!=null">
			and id = #{query.id}
		</if>
		<if test="query.title!=null and query.title!=''">
			and title = #{query.title}
		</if>
		<if test="query.description!=null and query.description!=''">
			and description = #{query.description}
		</if>
		<if test="query.category!=null and query.category!=''">
			and category = #{query.category}
		</if>
		<if test="query.videoUrl!=null and query.videoUrl!=''">
			and video_url = #{query.videoUrl}
		</if>
		<if test="query.duration!=null">
			and duration = #{query.duration}
		</if>
		<if test="query.publishTime!=null">
			and publish_time = #{query.publishTime}
		</if>
	</sql>

	<!--拓展的查询条件-->
	<sql id="base_query_condition_extend">
		<if test="query.titleFuzzy!=null and query.titleFuzzy!=''">
			and title like concat ('%', #{query.titleFuzzy}, '%')
		</if>
		<if test="query.descriptionFuzzy!=null and query.descriptionFuzzy!=''">
			and description like concat ('%', #{query.descriptionFuzzy}, '%')
		</if>
		<if test="query.categoryFuzzy!=null and query.categoryFuzzy!=''">
			and category like concat ('%', #{query.categoryFuzzy}, '%')
		</if>
		<if test="query.videoUrlFuzzy!=null and query.videoUrlFuzzy!=''">
			and video_url like concat ('%', #{query.videoUrlFuzzy}, '%')
		</if>
		<if test="query.publishTimeStart!=null and query.publishTimeStart!=''">
			<![CDATA[ and publish_time>=str_to_date(#{query.publishTimeStart}, '%Y-%m-%d') ]]>
		</if>
		<if test="query.publishTimeEnd!=null and query.publishTimeEnd!=''">
			<![CDATA[ and publish_time< date_sub(str_to_date(#{query.publishTimeEnd},'%Y-%m-%d')，interval -1 day) ]]>
		</if>

	</sql>

	<!--通用的查询条件-->
	<sql id="query_condition">
		<where>
			<include refid="base_query_condition"/>
			<include refid="base_query_condition_extend"/>
		</where>
	</sql>

	<!--查询列表-->
	<select id = "selectList" resultMap="base_result_map">
		SELECT
		<include refid="base_column_list"/>
		FROM video_info
		<include refid="query_condition"/>
		<if test="query.orderBy!=null">order by ${query.orderBy}</if>
		<if test="query.simplePage!=null">limit #{query.simplePage.start},#{query.simplePage.end}</if>
	</select>

	<!--查询数量-->
	<select id = "selectCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM video_info
		<include refid="query_condition"/>
	</select>

	<!--插入 （匹配有值的字段）-->
	<insert id = "insert" parameterType="shichuan.zhiyuan.entity.po.VideoInfo">
		<selectKey keyProperty="bean.id" resultType="Integer" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
		INSERT INTO video_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				id,
			</if>
			<if test="bean.title != null">
				title,
			</if>
			<if test="bean.description != null">
				description,
			</if>
			<if test="bean.category != null">
				category,
			</if>
			<if test="bean.videoUrl != null">
				video_url,
			</if>
			<if test="bean.duration != null">
				duration,
			</if>
			<if test="bean.publishTime != null">
				publish_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				#{bean.id},
			</if>
			<if test="bean.title != null">
				#{bean.title},
			</if>
			<if test="bean.description != null">
				#{bean.description},
			</if>
			<if test="bean.category != null">
				#{bean.category},
			</if>
			<if test="bean.videoUrl != null">
				#{bean.videoUrl},
			</if>
			<if test="bean.duration != null">
				#{bean.duration},
			</if>
			<if test="bean.publishTime != null">
				#{bean.publishTime},
			</if>
		</trim>
	</insert>

		<!-- 插入或者更新 （匹配有值的字段） -->
	<insert id = "insertOrUpdate" parameterType="shichuan.zhiyuan.entity.po.VideoInfo">
		INSERT INTO video_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				id,
			</if>
			<if test="bean.title != null">
				title,
			</if>
			<if test="bean.description != null">
				description,
			</if>
			<if test="bean.category != null">
				category,
			</if>
			<if test="bean.videoUrl != null">
				video_url,
			</if>
			<if test="bean.duration != null">
				duration,
			</if>
			<if test="bean.publishTime != null">
				publish_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="bean.id != null">
				#{bean.id},
			</if>
			<if test="bean.title != null">
				#{bean.title},
			</if>
			<if test="bean.description != null">
				#{bean.description},
			</if>
			<if test="bean.category != null">
				#{bean.category},
			</if>
			<if test="bean.videoUrl != null">
				#{bean.videoUrl},
			</if>
			<if test="bean.duration != null">
				#{bean.duration},
			</if>
			<if test="bean.publishTime != null">
				#{bean.publishTime},
			</if>
		</trim>
		on DUPLICATE key update
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="bean.title != null">
				 title = VALUES(title)
			</if>
			<if test="bean.description != null">
				 description = VALUES(description)
			</if>
			<if test="bean.category != null">
				 category = VALUES(category)
			</if>
			<if test="bean.videoUrl != null">
				 video_url = VALUES(video_url)
			</if>
			<if test="bean.duration != null">
				 duration = VALUES(duration)
			</if>
			<if test="bean.publishTime != null">
				 publish_time = VALUES(publish_time)
			</if>
		</trim>
	</insert>

	<!-- 批量插入 -->
	<insert id ="insertBatch" parameterType="shichuan.zhiyuan.entity.po.VideoInfo">
		INSERT INTO video_info(title,description,category,video_url,duration,publish_time) VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.title},#{item.description},#{item.category},#{item.videoUrl},#{item.duration},#{item.publishTime})
		</foreach>
	</insert>

	<!-- 批量插入（或者更新） -->
	<insert id ="insertOrUpdateBatch" parameterType="shichuan.zhiyuan.entity.po.VideoInfo">
		INSERT INTO video_info(title,description,category,video_url,duration,publish_time) VALUES
		<foreach collection="list" item="item" separator="," >
			(#{item.title},#{item.description},#{item.category},#{item.videoUrl},#{item.duration},#{item.publishTime})
		</foreach>
			on DUPLICATE key update
			title= VALUES(title),description= VALUES(description),category= VALUES(category),video_url= VALUES(video_url),duration= VALUES(duration),publish_time= VALUES(publish_time)
	</insert>

	<!-- 根据Id查询 -->
	<select id="selectById" resultMap="base_result_map">
		select <include refid="base_column_list"/> from video_info where id=#{id}
	</select>

	<!-- 根据Id更新 -->
	<update id="updateById" parameterType="shichuan.zhiyuan.entity.po.VideoInfo">
		update video_info
		<set>
			<if test="bean.id != null">
				id = #{bean.id},
			</if>
			<if test="bean.title != null">
				title = #{bean.title},
			</if>
			<if test="bean.description != null">
				description = #{bean.description},
			</if>
			<if test="bean.category != null">
				category = #{bean.category},
			</if>
			<if test="bean.videoUrl != null">
				video_url = #{bean.videoUrl},
			</if>
			<if test="bean.duration != null">
				duration = #{bean.duration},
			</if>
			<if test="bean.publishTime != null">
				publish_time = #{bean.publishTime},
			</if>
		</set>
		where id=#{id}
	</update>

	<!-- 根据Id删除 -->
	<delete id="deleteById">
		delete from video_info where id=#{id}
	</delete>
</mapper>